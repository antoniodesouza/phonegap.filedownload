<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <title>PhoneGap filedownload</title>
        
        
		<script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript">
            app.initialize();
        </script>
        <script>
        
         
			function onBodyLoad()
			{
				document.addEventListener("deviceready", onDeviceReady, false);
			}
 
			function downloadFile(){
				window.requestFileSystem(
							 LocalFileSystem.PERSISTENT, 0, 
							 function onFileSystemSuccess(fileSystem) {
							 fileSystem.root.getFile(
										 "dummy.html", {create: true, exclusive: false}, 
										 function gotFileEntry(fileEntry){
										 var sPath = fileEntry.fullPath.replace("dummy.html","");
										 var fileTransfer = new FileTransfer();
										 fileEntry.remove();
										 
										 console.log(sPath);
 
										 fileTransfer.download(
												   /*"http://www.w3.org/2011/web-apps-ws/papers/Nitobi.pdf",*/
												   "http://www.ncu.edu.tw/~ncu25352/Uploads/20131231103232738561744.pdf",
												   sPath + "theFile.pdf",
												   function(theFile) {
												   console.log("download complete: " + theFile.toURI());
												   showLink(theFile.toURI());
												   },
												   function(error) {
												   console.log("download error source " + error.source);
												   console.log("download error target " + error.target);
												   console.log("upload error code: " + error.code);
												   }
												   );
										 }, 
										 fail);
							 }, 
							 fail);
 
			}
 
			function showLink(url){
				alert(url);
				var divEl = document.getElementById("ready");
				var aElem = document.createElement("a");
				aElem.setAttribute("target", "_blank");
				aElem.setAttribute("href", url);
				aElem.appendChild(document.createTextNode("Ready! Click To Open."))
				divEl.appendChild(aElem);
 
			}
 
 
			function fail(evt) {
				console.log(evt.target.error.code);
			}
 
			function onDeviceReady()
			{
				downloadFile();
			}
 
        
        
        </script>
        
    </head>
    <body onload="onBodyLoad()">
        <div class="app">
            <h1>Apache Cordova</h1>
            <div id="deviceready" class="blink">
                <p class="event listening">Connecting to Device</p>
                <p class="event received">Device is Ready</p>
            </div>
        </div>

        
        
		<p>
			DOWNLOADING FILE...<br />
			<span id="ready"></span>
		</p>
        
    </body>
</html>
